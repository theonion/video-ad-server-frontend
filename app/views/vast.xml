<VAST xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" version="2.0" xsi:noNamespaceSchemaLocation="vast.xsd">
    {% if ad %}
    <Ad id="{{ad.pk}}" {% if ad.gam_attribute %}target="{{ ad.gam_attribute }}"{% endif %}>
        {% if ad.vast_url %}
        <Wrapper>
            <VASTAdTagURI><![CDATA[{{ ad.get_vast_url|safe}}]]></VASTAdTagURI>
            <Impression><![CDATA[http://reporting.theonion.com/videoadtracker/track.gif?videoAd={{ ad.id }}&event=impression]]></Impression>
            <Creatives>
                <Creative>
                    <Linear>
                        <TrackingEvents>
                            {% include "videoads/tracking_events.xml" %}
                        </TrackingEvents>
                    </Linear>
                </Creative>
            </Creatives>
            <TrackingEvents>
            </TrackingEvents>
        </Wrapper>
        {% else %}
        <InLine>
            <AdSystem version="2.0">ONION</AdSystem>
            <AdTitle>In-Stream Video</AdTitle>
            <Description>{{ ad.name|escape }}</Description>
	       {% for pixel in ad.get_pixels.impression %}
            <Impression><![CDATA[{{pixel|safe}}]]></Impression>â€¨
	       {% endfor %}
            <Impression><![CDATA[http://reporting.theonion.com/videoadtracker/track.gif?videoAd={{ ad.id }}&event=impression]]></Impression>
            <Creatives>
                <Creative sequence="1" AdID="">
                    <Linear>
                        <Duration>00:00:{{ duration }}</Duration>
                        <TrackingEvents>
                            {% include "videoads/tracking_events.xml" %}
                        </TrackingEvents>
                        {% if ad.click_through%}
                        <VideoClicks>
                            <ClickThrough><![CDATA[{{ ad.click_through }}]]></ClickThrough>
                        </VideoClicks>
                        {% endif %}
                        <MediaFiles>
                        {% for video in ad.video.get_sources %}
                            <MediaFile id="1" delivery="progressive" type="{{ video.content_type }}"><![CDATA[{{ video.url|safe }}]]></MediaFile>
                        {% endfor %}
                        </MediaFiles>
                    </Linear>
                </Creative>
            </Creatives>
      </InLine>
      {% endif %}
    </Ad>
    {% endif %}
</VAST>