{"version":3,"file":"app.min.js","sources":["../../app/scripts/app.js","../../app/scripts/jquery-video-upload.js","../../app/videos/videoAttrs.js","../../app/scripts/controllers/exclusion.js","../../app/scripts/controllers/video-ad-form.js","../../app/scripts/controllers/list.js","../../app/scripts/controllers/login.js","../../app/scripts/directives/delivery.js","../../app/scripts/directives/pixels.js","../../app/scripts/directives/targeting.js","../../app/scripts/directives/videoupload.js","../../app/scripts/directives/chart.js","../../app/scripts/services/video-ad.js","../../app/scripts/services/token-auth.js","../../app/scripts/filters/converttolocal.js"],"names":["angular","module","config","$locationProvider","$httpProvider","$routeProvider","$sceDelegateProvider","resourceUrlWhitelist","html5Mode","when","templateUrl","controller","reloadOnSearch","otherwise","redirectTo","$","window","document","undefined","S3Upload","element","options","this","extend","defaults","_defaults","_name","pluginName","init","bootstrap","videoAttrs","callback","prototype","lastProgress","setProgress","progress","progressEl","hide","Math","abs","find","css","floor","show","setProgressText","text","html","abortUpload","button","off","req","abort","removeClass","addClass","on","proxy","chooseFile","abortEncode","self","jobId","attr","ajax","zencoderApiKey","type","success","fakeInput","val","upload","file","files","url","bucket","formData","FormData","path","directory","videoId","append","AWSAccessKeyId","acl","success_action_status","policy","signature","jQuery","processData","contentType","data","xhr","ajaxSettings","addEventListener","e","percent","loaded","total","name","post","filename","encode","updateEncodeProgress","api_key","state","setTimeout","clearFile","id","console","log","click","el","tagName","target","length","size","alert","indexOf","dataType","initial_file","status","after","fn","each","Content-Type","$scope","$http","$routeParams","exclusion","page_targets","user_targets","method","exclusionName","save","fadeIn","delay","fadeOut","error","videoAdService","$location","errors","videoad","initVideoAd","targeting","page","user","video","pickerOptions","timePicker","timePickerIncrement","format","inputVal","start","startDate","moment","utc","local","end","endDate","daterangepicker","getAndInitVideoAd","_","isUndefined","videoAdId","one","get","then","addTargetingKey","key","targetingKey","saveVideoAd","videoAds","params","isEmpty","search","show_search_bar","searchTerm","currentPage","totalItems","filter","loading","updateList","getList","meta","count","newVideoAd","changeOrder","orderBy","reverse","changeFilter","changePage","loginService","username","password","submitLogin","login","directive","scope","pixels","link","keyCode","parent","addPixel","bt","event","parents","pixel","siblings","push","removePixel","index","splice","targets","priorities","addTargetingGroup","priority","rules","removeTargetingGroup","confirm","modal","$apply","addTargetingRow","removeTargetingRow","parentIndex","$window","$timeout","elem","uploading","fileInput","progressBar","param","headers","encoding","job_id","progressText","common","useXDomain","statuses",1,2,3,"bind","initialCheckRan","$watch","restrict","impressions","semiCircleConfig","chart","backgroundColor","height","margin","width","credits","enabled","tooltip","colors","series","dataLabels","states","hover","animation","startAngle","endAngle","center","innerSize","parseInt","title","subtitle","factory","Restangular","setBaseUrl","setRequestSuffix","service","RestangularProvider","addResponseInterceptor","operation","results","prev","next","$rootScope","$q","httpRequestBuffer","request","sessionStorage","token","Authorization","responseError","response","ignoreAuthModule","deferred","defer","$broadcast","reject","interceptors","_login","_refreshToken","retryAll","rejectAll","refreshToken","$injector","_retryHttpRequest","successCallback","resolve","errorCallback","buffer","reason","input"],"mappings":"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","sourcesContent":["'use strict';\n\n// ****** App Config ****** \\\\\n\nangular.module('video-ads', [\n  'ngCookies',\n  'ngRoute',\n  'ngAnimate',\n  'ui.bootstrap',\n  'restangular',\n  'highcharts-ng'\n])\n  .config(function($locationProvider, $httpProvider, $routeProvider, $sceDelegateProvider) {\n    $sceDelegateProvider.resourceUrlWhitelist(['self', 'http://assets.onionstatic.com/videoads/*']);\n\n    $locationProvider.html5Mode(true);\n\n    $routeProvider\n      .when('/', {\n        templateUrl: 'views/partials/list.html',\n        controller: 'ListCtrl',\n        reloadOnSearch: false\n      })\n      .when('/login', {\n        templateUrl: 'views/partials/login.html',\n        controller: 'LoginCtrl'\n      })\n      .when('/edit/:videoAdId/', {\n        templateUrl: 'views/partials/form.html',\n        controller: 'FormCtrl'\n      })\n      .when('/new/', {\n        templateUrl: 'views/partials/form.html',\n        controller: 'FormCtrl'\n      })\n      .when('/exclusion/:exclusionName/', {\n        templateUrl: 'views/partials/exclusion.html',\n        controller: 'ExclusionCtrl'\n      })\n      .otherwise({\n        redirectTo: '/'\n      });\n  });","/*!\n * S3 Upload\n * Original author: @chrissinchok\n * Licensed under the MIT license\n */\n\n// the semi-colon before the function invocation is a safety\n// net against concatenated scripts and/or other plugins\n// that are not closed properly.\n;(function ( $, window, document, undefined ) {\n\n    // undefined is used here as the undefined global\n    // variable in ECMAScript 3 and is mutable (i.e. it can\n    // be changed by someone else). undefined isn't really\n    // being passed in so we can ensure that its value is\n    // truly undefined. In ES5, undefined can no longer be\n    // modified.\n\n    // window and document are passed through as local\n    // variables rather than as globals, because this (slightly)\n    // quickens the resolution process and can be more\n    // efficiently minified (especially when both are\n    // regularly referenced in your plugin).\n\n    // Create the defaults once\n    var pluginName = \"s3upload\",\n        defaults = {\n            bootstrap: true,  // This is all I will be building, at least initially.\n            videoAttrs: {},\n            callback: function(){}\n        };\n\n    // The actual plugin constructor\n    function S3Upload( element, options ) {\n        this.element = element;\n\n        // jQuery has an extend method that merges the\n        // contents of two or more objects, storing the\n        // result in the first object. The first object\n        // is generally empty because we don't want to alter\n        // the default options for future instances of the plugin\n        this.options = $.extend( {}, defaults, options) ;\n\n        this._defaults = defaults;\n        this._name = pluginName;\n\n        this.init();\n    }\n\n    S3Upload.prototype = {\n\n        lastProgress: 0,\n\n        setProgress: function(progress) {\n            if (progress === 0 || progress === 100) {\n                this.progressEl.hide();\n                return;\n            }\n            if(this.lastProgress === 0 || Math.abs(progress - this.lastProgress) > 2) {\n                this.progressEl.find('.progress-bar').css('width', Math.floor(progress) + '%');\n                this.lastProgress = progress;\n                this.progressEl.show();\n            }\n        },\n\n        setProgressText: function(text) {\n            this.progressEl.find('.progress-bar span').html(text);\n        },\n\n        abortUpload: function(e) {\n            this.setProgress(0);\n            this.button.off('click', this.abortUpload);\n            this.req.abort();\n            this.button.removeClass('btn-danger');\n            this.button.addClass('btn-default');\n            this.button.html(\"Choose File\");\n            this.button.on('click', $.proxy(this.chooseFile, this));\n            this.setProgress(0);\n        },\n\n        abortEncode: function(e) {\n            var self = this;\n\n            this.button.off('click');\n\n            jobId = $(this.element).attr('data-job-id');\n            $.ajax(\"https://app.zencoder.com/api/v2/jobs/\" + jobId + \"/cancel.json?api_key=\" + videoAttrs.zencoderApiKey, {\n                type: \"PUT\",\n                success: function(data) {\n                    self.button.removeClass('btn-danger');\n                    self.button.addClass('btn-default');\n                    self.button.html(\"Choose File\");\n                    $(self.element).attr('data-status', \"Failed\");\n\n                    self.fakeInput.val(\"Encoding failed! Please try again.\");\n\n                    self.button.on('click', $.proxy(self.chooseFile, self));\n                }\n            });\n        },\n\n        upload: function() {\n\n            // TODO: Add cancel button.\n            var self = this;\n\n            this.button.off('click', this.chooseFile);\n            this.button.addClass('btn-danger');\n            this.button.removeClass('btn-default');\n            this.button.html(\"Abort\");\n            this.button.on('click', $.proxy(this.abortUpload, this));\n\n            var file = this.element.files[0];\n            var url = \"https://\" + this.options.videoAttrs.bucket + \".s3.amazonaws.com\";\n\n            var formData = new FormData();\n            var path = videoAttrs.directory + \"/\" + this.videoId + \"/original\";\n            var filename = \"s3://\" + this.options.videoAttrs.bucket + \"/\" + path;\n\n            formData.append('key', path);\n            formData.append('AWSAccessKeyId', this.options.videoAttrs.AWSAccessKeyId);\n            formData.append('acl', this.options.videoAttrs.acl);\n            formData.append('success_action_status', this.options.videoAttrs.success_action_status);\n            formData.append('policy', this.options.videoAttrs.policy);\n            formData.append('signature', this.options.videoAttrs.signature);\n            formData.append('file', file);\n\n            self.setProgress(0);\n            self.setProgressText(\"Uploading...\");\n            this.progressEl.find('.progress-bar').removeClass('progress-bar-success');\n            // Todo: handle failure\n            jQuery.ajax(url, {\n                processData: false,\n                contentType: false,\n                data: formData,\n                type: \"POST\",\n                xhr: function() {\n                    var req = $.ajaxSettings.xhr();\n                    if (req) {\n                        req.upload.addEventListener('progress', function(e) {\n                            var percent = (e.loaded / e.total ) * 100;\n                            self.setProgress(percent);\n                        }, false);\n                    }\n                    self.req = req;\n                    return req;\n                },\n                success: function(data) {\n                    self.setProgress(100);\n                    self.fakeInput.val(file.name);\n                    $.post('/videos/' + self.videoId, {\n                        'filename': file.name\n                    });\n                    self.encode();\n                }\n            });\n        },\n\n        updateEncodeProgress: function() {\n            var self = this;\n            this.progressEl.find('.progress-bar').addClass('progress-bar-success');\n\n            jobId = $(this.element).attr('data-job-id');\n            $.ajax(\"https://app.zencoder.com/api/v2/jobs/\" + jobId + \"/progress.json\", {\n                type: \"GET\",\n                data: {\n                    api_key: videoAttrs.zencoderApiKey\n                },\n                success: function(data) {\n                    if(data.state === \"waiting\" || data.state === \"pending\" || data.state === \"processing\") {\n                        if(data.progress > 5) {\n                            self.setProgress(data.progress);\n                            setTimeout($.proxy(self.updateEncodeProgress, self), 500);\n                        } else {\n                            setTimeout($.proxy(self.updateEncodeProgress, self), 2000);\n                        }\n                    } else {\n                        self.setProgress(0);\n                        if(data.state == \"finished\") {\n                            $(self.element).attr('data-status', \"Completed\");\n                            self.button.off('click');\n                            self.button.html('Clear');\n                            self.button.on('click', $.proxy(self.clearFile, self));\n                        }\n                        if(data.state == \"failed\" || data.state == \"cancelled\") {\n                            $(self.element).attr('data-status', \"Failed\");\n                            self.fakeInput.val(\"Encoding failed! Please try again.\");\n                            self.button.off('click');\n                            self.button.html('Choose File');\n                            self.button.on('click', $.proxy(self.chooseFile, self));\n                        }\n                    }\n                }\n            });\n        },\n\n        encode: function() {\n            var self = this;\n\n            this.button.off('click');\n            this.button.on('click', $.proxy(this.abortEncode, this));\n\n            this.progressEl.find('.progress-bar').addClass('progress-bar-success');\n            this.setProgressText(\"Encoding...\");\n            this.setProgress(5);\n            // Kick off the zencoder job\n            $.ajax('/videos/' + self.videoId + \"/encode\", {\n                type: \"POST\",\n                data: {\n                    'name': $(self.element).attr('data-video-name'),\n                },\n                success: function(data) {\n                    $(self.element).attr('data-job-id', data.id);\n                    self.updateEncodeProgress();\n                }\n            });\n        },\n\n        chooseFile: function(e) {\n            console.log(\"chooseFile\")\n            this.button.off('click', this.chooseFile);\n            this.element.click();\n        },\n\n        clearFile: function(e) {\n            this.button.off('click', this.clearFile);\n            this.button.removeClass('btn-danger');\n            this.button.addClass('btn-default');\n            this.button.html(\"Choose File\");\n            this.fakeInput.val('');\n            this.button.on('click', $.proxy(this.chooseFile, this));\n        },\n\n        init: function() {\n            var el = $(this.element);\n            var self = this;\n\n            if(this.element.tagName != \"INPUT\" || this.element.type != \"file\") {\n                console.log(\"You must attach this to a file input tag!\");\n                return false;\n            }\n\n            el.on('change', function(e) {\n                var file;\n                if(e.target.files.length !== 0) {\n                    file = e.target.files[0];\n\n                    // We have a file upload limit of 300MB\n                    if (file.size > (1024 * 1024 * 1024)) {\n                        alert(\"Upload file cannot be larger than 300MB.\");\n                        self.button.on('click', $.proxy(self.chooseFile, self));\n                        return;\n                    }\n\n                    if (file.type.indexOf('video/') !== 0) {\n                        alert(\"You must upload a video file.\");\n                        self.button.on('click', $.proxy(self.chooseFile, self));\n                        return;\n                    }\n\n                } else {\n                    return;\n                }\n\n                if($(e.target).attr('data-video-id') === undefined) {\n                    $.ajax({\n                        type: \"POST\",\n                        url: \"/videos/new\",\n                        data: {'filename': file.name},\n                        success: function(data, textStatus, jqXHR){\n                            $(e.target).attr('data-video-id', data.id);\n                            self.videoId = data.id;\n                            self.options.callback(data.id);\n                            self.upload();\n                        },\n                        dataType: \"json\"\n                    });\n                } else {\n                    self.upload();\n                }\n            });\n\n            var initial_file = el.attr('data-video-name') || \"\";\n            this.videoId = el.attr('data-video-id');\n            this.jobId = el.attr('data-job-id');\n            this.status = el.attr('data-status');\n\n            this.progressEl = $('<div class=\"progress progress-striped active s3uploadProgress\"><div class=\"progress-bar\" style=\"width: 0%\"><span class=\"pull-left\">Uploading...</span></div></div>');\n            this.progressEl.hide();\n\n            this.button = $('<label class=\"btn btn-default pull-right s3uploadButton\">Choose File</label>');\n\n            if(initial_file !== \"\") {\n                if(this.status === \"In Progress\") {\n                    this.button.removeClass('btn-default');\n                    this.button.addClass('btn-danger');\n                    this.button.html(\"Abort\");\n                    this.button.on('click', $.proxy(this.abortEncode, this));\n\n                    this.setProgress(5);\n                    this.setProgressText(\"Encoding...\");\n                    this.updateEncodeProgress();\n                }\n                if(this.status === \"Complete\") {\n                    this.button.removeClass('btn-default');\n                    this.button.addClass('btn-danger');\n                    this.button.html(\"Clear\");\n                    this.button.on('click', $.proxy(this.clearFile, this));\n                }\n\n            } else {\n                this.button.on('click', $.proxy(this.chooseFile, this));\n            }\n\n            this.fakeInput = $('<input type=\"text\" class=\"form-control\" value=\"' + initial_file + '\" disabled>');\n\n            el.after(this.progressEl);\n            el.after(this.button);\n            el.after(this.fakeInput);\n            el.css('position', 'absolute');\n            el.css('left', '-6000px');\n        },\n    };\n\n    // A really lightweight plugin wrapper around the constructor,\n    // preventing against multiple instantiations\n    $.fn[pluginName] = function ( options ) {\n        return this.each(function () {\n            if (!$.data(this, \"plugin_\" + pluginName)) {\n                $.data(this, \"plugin_\" + pluginName,\n                new S3Upload( this, options ));\n            }\n        });\n    };\n\n})( jQuery, window, document );","var videoAttrs = {\"directory\": \"videoads\", \"AWSAccessKeyId\": \"AKIAJ242ND767HPT2HJQ\", \"signature\": \"wHN+x9KT6Y+LexLBKTkmQ9EvOhU=\", \"policy\": \"eyJjb25kaXRpb25zIjogW3siYnVja2V0IjogIm9uaW9ud2VidGVjaCJ9LCB7ImFjbCI6ICJwcml2YXRlIn0sIHsic3VjY2Vzc19hY3Rpb25fc3RhdHVzIjogIjIwMSJ9LCBbInN0YXJ0cy13aXRoIiwgIiRrZXkiLCAidmlkZW9hZHMiXSwgWyJjb250ZW50LWxlbmd0aC1yYW5nZSIsIDAsIDEwNzM3NDE4MjRdXSwgImV4cGlyYXRpb24iOiAiMjAxNC0xMC0xNVQyMDowOTo0OC4wMDBaIn0=\", \"bucket\": \"onionwebtech\", \"success_action_status\": \"201\", \"Content-Type\": \"$Content-Type\", \"zencoderApiKey\": \"7401a69bd1bca22e4bb7bf6ae38d4220\", \"acl\": \"private\"};","'use strict';\n\nangular.module('video-ads')\n    .controller('ExclusionCtrl', function ($scope, $http, $routeParams) {\n        $scope.exclusion = {};\n\n        $scope.page_targets = [\n            'dfp_adchannel',\n            'dfp_pagetype',\n            'dfp_viewport',\n            'dfp_channel',\n            'dfp_articletype',\n            'dfp_site',\n            'dfp_articleid'\n        ];\n        $scope.user_targets = [\n            'city',\n            'region',\n            'country_code'\n        ];\n\n        $http({\n            method: 'GET',\n            url: '/api/v1/exclusions/' + $routeParams.exclusionName + '/'\n        }).success(function(data){\n            $scope.exclusion = data;\n        });\n\n        $scope.save = function() {\n            var data = $scope.exclusion;\n            $http({\n                method: 'PATCH',\n                url: '/api/v1/exclusions/' + $routeParams.exclusionName + '/',\n                data: data\n            }).success(function(data){\n                $('.alert-success').fadeIn().delay(1000).fadeOut()\n            }).error(function(data){\n                $('.alert-danger').fadeIn().delay(1000).fadeOut()\n            });\n        };\n    });","'use strict';\n\nangular.module('video-ads')\n  .controller('FormCtrl', function ($scope, $routeParams, videoAdService, $location) {\n    $scope.success = false;\n    $scope.errors = false;\n    $scope.videoad = {};\n    //TODO: Magic strings could be moved into constants?\n    $scope.page_targets = [\n      'dfp_adchannel',\n      'dfp_pagetype',\n      'dfp_viewport',\n      'dfp_channel',\n      'dfp_articletype',\n      'dfp_site',\n      'dfp_articleid'\n    ];\n    $scope.user_targets = [\n      'city',\n      'region',\n      'country_code'\n    ];\n\n    $scope.initVideoAd = function () {\n      if (!$scope.videoad.targeting) {\n        $scope.videoad.targeting = {};\n      }\n      if (!$scope.videoad.targeting.page) {\n        $scope.videoad.targeting.page = [];\n      }\n      if (!$scope.videoad.targeting.user) {\n        $scope.videoad.targeting.user = [];\n      }\n      $scope.videoad.video = $scope.videoad.video || {};\n      var pickerOptions = {\n        timePicker: true,\n        timePickerIncrement: 30,\n        format: 'YYYY-MM-DD hh:mm A'\n      };\n\n      var inputVal = \"\";\n      if ($scope.videoad.start) {\n        pickerOptions.startDate = moment.utc($scope.videoad.start).local().format('YYYY-MM-DD hh:mm A');\n        inputVal += pickerOptions.startDate;\n      }\n\n      if ($scope.videoad.end) {\n        pickerOptions.endDate = moment.utc($scope.videoad.end).local().format('YYYY-MM-DD hh:mm A');\n        inputVal += \" - \" + pickerOptions.endDate;\n      }\n\n      $('#runtime').val(inputVal);\n\n      $('#runtime').daterangepicker(pickerOptions, function (start, end) {\n        $scope.videoad.start = moment(start, 'YYYY-MM-DD hh:mm A').utc().format();\n        $scope.videoad.end = moment(end, 'YYYY-MM-DD hh:mm A').utc().format();\n      });\n    };\n\n    $scope.getAndInitVideoAd = function () {\n      if (_.isUndefined($routeParams.videoAdId)) {\n        $scope.videoAdId = {};\n        $scope.initVideoAd();\n      }\n      videoAdService.one($routeParams.videoAdId).get().then(\n        function (data) {\n          $scope.videoad = data;\n          $scope.initVideoAd();\n        },\n        function (data) {\n          console.log(data);\n        }\n      );\n    };\n\n    $scope.addTargetingKey = function (key) {\n      $scope.targetingKey = key;\n    };\n\n    $scope.saveVideoAd = function () {\n      if (!_.isUndefined($routeParams.videoAdId)) {\n        $('.alert-success').fadeIn().delay(1000).fadeOut();\n        $scope.videoad.save();\n      } else {\n        $('.alert-danger').fadeIn().delay(1000).fadeOut();\n        videoAdService.post($scope.videoad)\n          .then(function (data) {\n            $location.path('/edit/' + data.id);\n          });\n      }\n    };\n    $scope.getAndInitVideoAd();\n  });","'use strict';\nangular.module('video-ads')\n  .controller('ListCtrl', function($scope, $location, videoAdService, $routeParams) {\n    $scope.videoAds = [];\n    if (_.isEmpty($location.search())) {\n      $scope.params = {};\n    } else {\n      $scope.params = $location.search();\n    }\n    $scope.show_search_bar = true;\n    $scope.searchTerm = \"\";\n    $scope.currentPage = 1;\n    $scope.totalItems = 0;\n    $scope.params.filter = 'active';\n    $scope.params = $routeParams;\n    $scope.loading = true;\n    $scope.errors = false;\n\n    $scope.updateList = function() {\n      if ($scope.params.filter === undefined) {\n        $scope.params.filter = \"active\";\n      }\n      $location.search($scope.params);\n      videoAdService.getList([$scope.params]).then(function(data) {\n        $scope.videoAds = data;\n        $scope.totalItems = data.meta.count;\n        $scope.loading = false;\n      }, function(progress) {\n          $scope.loading = true;\n      }, function(error) {\n          $scope.loading = false;\n          $scope.errors = true;\n          console.log(error);\n      });\n    };\n\n    $scope.updateList();\n\n    $scope.newVideoAd = function() {\n      $location.path('/new/');\n    };\n\n    $scope.changeOrder = function() {\n      $scope.params.orderBy = $scope.orderBy;\n      if ($scope.reverse) {\n        $scope.params.orderBy = \"-\" + $scope.orderBy;\n      }\n      //Setting currentPage to 1 will trigger the currentPage watch to fire\n      $scope.currentPage = 1;\n      $scope.updateList();\n    };\n\n    $scope.changeFilter = function() {\n      //This will trigger the above watch statement, which will trigger an updateList()\n      $scope.currentPage = 1;\n      $scope.updateList();\n    };\n\n    $scope.changePage = function() {\n      $scope.params.page = $scope.currentPage;\n      $scope.updateList();\n    };\n\n    $scope.search = function() {\n      $scope.params.search = $scope.searchTerm;\n      $scope.updateList();\n    };\n\n  });","'use strict';\n\nangular.module('video-ads')\n    .controller('LoginCtrl', function($scope, loginService) {\n        $scope.username = \"\";\n        $scope.password = \"\";\n        $scope.submitLogin = function() {\n            loginService.login($scope.username, $scope.password);\n        }\n    });","'use strict';\n\nangular.module('video-ads')\n  .directive('delivery', function() {\n    return {\n      templateUrl: 'views/partials/delivery-progress.html',\n      scope: {\n          'videoad': '='\n      }\n    }\n  });","'use strict';\n\nangular.module('video-ads')\n\t.directive('pixels', function() {\n\t\treturn {\n\t\t\ttemplateUrl: 'views/partials/pixels.html',\n\t\t\tscope: {\n\t\t\t\t'videoad': '=',\n\t\t\t\t'pixels': '='\n\t\t\t},\n\t\t\tlink: function($scope, elem, attrs){\n\t\t\t\t$(\"#pixels-wrapper\").on('keypress', 'input', function(e){\n\t\t\t\t\tif(e.keyCode === 13){\n\t\t\t\t\t\t$(e.target).parent().find('button').click();\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t$scope.addPixel = function(e){\n\t\t\t\t\tvar bt = $(e.target);\n\t\t\t\t\tvar event = $(bt).parents('[data-event]').data('event');\n\t\t\t\t\tvar pixel = $(bt).parent().siblings('input').val()\n\t\t\t\t\tif(pixel.length > 0){\n\t\t\t\t\t\t$scope.videoad.pixels[event].push(pixel)\n\t\t\t\t\t\t$(bt).parent().siblings('input').val('')\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t$scope.removePixel = function(event, index){\n\t\t\t\t\t$scope.videoad.pixels[event].splice(index, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});","'use strict';\n\nangular.module('video-ads')\n\t.directive('targeting', function() {\n\t\treturn {\n\t\t\ttemplateUrl: 'views/partials/targeting.html',\n\t\t\tscope: {\n\t\t\t\t'target': '=',\n\t\t\t\t'targets': '='\n\t\t\t},\n\t\t\tlink: function($scope, elem, attrs){\n\t\t\t\t$scope.priorities = [\n\t\t\t\t\t'low', \n\t\t\t\t\t'medium', \n\t\t\t\t\t'high'\n\t\t\t\t];\n\n\t\t\t\t$scope.addTargetingGroup = function(){\n\t\t\t\t\t$scope.target.push({\"priority\": \"medium\", \"rules\": [['', 'is', '']]});\n\t\t\t\t};\n\t\t\t\t$scope.removeTargetingGroup = function(index, confirm){\n\t\t\t\t\tif(confirm){\n\t\t\t\t\t\t$scope.target.splice(index, 1);\n\t\t\t\t\t\t$(\"#confirm-remove-group-modal\").modal('hide')\n\t\t\t\t\t}else{\n\t\t\t\t\t\t$(\"#confirm-remove-group-modal-button\").off('click');\n\t\t\t\t\t\t$(\"#confirm-remove-group-modal-button\").click(function(){\n\t\t\t\t\t\t\t$scope.removeTargetingGroup(index, true);\n\t\t\t\t\t\t\t$scope.$apply();\n\t\t\t\t\t\t});\n\t\t\t\t\t\t$(\"#confirm-remove-group-modal\").modal('show')\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t$scope.addTargetingRow = function(index){\n\t\t\t\t\t$scope.target[index][\"rules\"].push(['', 'is', '']);\n\t\t\t\t}\n\t\t\t\t$scope.removeTargetingRow = function(parentIndex, index){\n\t\t\t\t\t$scope.target[parentIndex][\"rules\"].splice(index, 1);\n\t\t\t\t\tif($scope.target[parentIndex][\"rules\"].length == 0){\n\t\t\t\t\t\t$scope.target.splice(parentIndex, 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});","'use strict';\n\nangular.module('video-ads')\n\t.directive('videoUpload', function ($http, $window, $timeout) {\n\t\treturn {\n\t\t\ttemplateUrl: 'views/partials/videoUpload.html',\n\t\t\tscope: {\n\t\t\t\t'videoad': '='\n\t\t\t},\n\t\t\tlink: function($scope, elem, attrs){\n\t\t\t\t$scope.errors = false;\n\t\t\t\t$scope.statuses = {\n\t\t\t\t\t0: \"Not Started\",\n\t\t\t\t\t1: \"Complete\",\n\t\t\t\t\t2: \"In Progress\",\n\t\t\t\t\t3: \"Failed\"\n\t\t\t\t};\n\n\t\t\t\tvar fileInput = elem.find('input[type=\"file\"]');\n\t\t\t\tvar button = elem.find('label.btn');\n\t\t\t\tvar progressEl = elem.find('div.progress');\n\t\t\t\tvar progressBar = elem.find('div.progress-bar');\n\t\t\t\tvar progressText = elem.find('div.progress span');\n\t\t\t\tvar fakeInput = elem.find('input.fake-input');\n\t\t\t\t$scope.lastProgress = 0;\n\n\t\t\t\tfileInput.bind('change', function(e) {\n\t\t\t\t\tvar file;\n\t\t\t\t\tconsole.log(\"HELLO\")\n\t\t\t\t\tconsole.log(e);\n\n\t\t\t\t\tif(e.target.files.length !== 0) {\n\t\t\t\t\t\tfile = e.target.files[0];\n\n\t\t\t\t\t\t// We have a file upload limit of 300MB\n\t\t\t\t\t\tif (file.size > (1024 * 1024 * 1024)) {\n\t\t\t\t\t\t\talert(\"Upload file cannot be larger than 300MB.\");\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (file.type.indexOf('video/') !== 0) {\n\t\t\t\t\t\t\talert(\"You must upload a video file.\");\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t$scope.videoad.video.name = file.name;\n\n\t\t\t\t\tif($scope.videoad.video.id === undefined) {\n\t\t\t\t\t\tconsole.log(\"posting\");\n\t\t\t\t\t\t$http({\n\t\t\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\t\t\turl: \"/videos/new\",\n\t\t\t\t\t\t\theaders: {'Content-Type': 'application/x-www-form-urlencoded'},\n\t\t\t\t\t\t\tdata: $.param({'filename': file.name})\n\t\t\t\t\t\t}).success(function(data){\n\t\t\t\t\t\t\tconsole.log(data);\n\t\t\t\t\t\t\t$scope.videoad.video.id = data.id;\n\t\t\t\t\t\t\t//TODO\n\t\t\t\t\t\t\t//self.options.callback(data.id);\n\t\t\t\t\t\t\tupload();\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tupload();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tfunction upload(){\n\t\t\t\t\t$scope.videoad.video.status = 2;\n\t\t\t\t\t$scope.uploading = true;\n\t\t\t\t\tvar file = $(fileInput)[0].files[0];\n\t\t\t\t\tvar url = \"https://\" + $window.videoAttrs.bucket + \".s3.amazonaws.com\";\n\n\t\t\t\t\tvar formData = new FormData();\n\t\t\t\t\tvar path = $window.videoAttrs.directory + \"/\" + $scope.videoad.video.id + \"/original\";\n\t\t\t\t\tvar filename = \"s3://\" + $window.videoAttrs.bucket + \"/\" + path;\n\n\t\t\t\t\tformData.append('key', path);\n\t\t\t\t\tformData.append('AWSAccessKeyId', $window.videoAttrs.AWSAccessKeyId);\n\t\t\t\t\tformData.append('acl', $window.videoAttrs.acl);\n\t\t\t\t\tformData.append('success_action_status', $window.videoAttrs.success_action_status);\n\t\t\t\t\tformData.append('policy', $window.videoAttrs.policy);\n\t\t\t\t\tformData.append('signature', $window.videoAttrs.signature);\n\t\t\t\t\tformData.append('file', file);\n\n\t\t\t\t\tsetProgress(0);\n\t\t\t\t\tsetProgressText(\"Uploading...\");\n\t\t\t\t\tprogressBar.removeClass('progress-bar-success');\n\t\t\t\t\t// Todo: handle failure\n\n\t\t\t\t\tjQuery.ajax(url, {\n\t\t\t\t\t\tprocessData: false,\n\t\t\t\t\t\tcontentType: false,\n\t\t\t\t\t\tdata: formData,\n\t\t\t\t\t\ttype: \"POST\",\n\t\t\t\t\t\txhr: function() {\n\t\t\t\t\t\t\tvar req = $.ajaxSettings.xhr();\n\t\t\t\t\t\t\tif (req) {\n\t\t\t\t\t\t\t\treq.upload.addEventListener('progress', function(e) {\n\t\t\t\t\t\t\t\tvar percent = (e.loaded / e.total ) * 100;\n\t\t\t\t\t\t\t\tsetProgress(percent);\n\t\t\t\t\t\t\t\t}, false);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t$scope.req = req;\n\t\t\t\t\t\t\treturn req;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsuccess: function(data) {\n\t\t\t\t\t\t\tsetProgress(100);\n\t\t\t\t\t\t\tfakeInput.val(file.name);\n\t\t\t\t\t\t\t$http({\n\t\t\t\t\t\t\t\turl: '/videos/' + $scope.videoad.video.id ,\n\t\t\t\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\t\t\t\tdata: $.param({\n\t\t\t\t\t\t\t\t\t'filename': file.name\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\theaders: {'Content-Type': 'application/x-www-form-urlencoded'}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t$http({\n\t\t\t\t\t\t\t\turl: '/videoads/' + $scope.videoad.id + \"/save\",\n\t\t\t\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\t\t\t\tdata: $.param({\n\t\t\t\t\t\t\t\t\t'videoId': $scope.videoad.video.id\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\theaders: {'Content-Type': 'application/x-www-form-urlencoded'}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tencode();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tfunction encode(){\n\t\t\t\t\t$scope.encoding = true;\n\t\t\t\t\tprogressBar.addClass('progress-bar-success');\n\t\t\t\t\tsetProgressText(\"Encoding...\");\n\t\t\t\t\tsetProgress(5);\n\t\t\t\t\t// Kick off the zencoder job\n\t\t\t\t\t$http({\n\t\t\t\t\t\turl: '/videos/' + $scope.videoad.video.id + \"/encode\",\n\t\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t'name': $scope.videoad.video.name,\n\t\t\t\t\t\t}\n\t\t\t\t\t}).success(function(data){\n\t\t\t\t\t\t$scope.videoad.video.job_id = data.id;\n\t\t\t\t\t\tupdateEncodeProgress();\n\t\t\t\t\t}).error(function(){\n\t\t\t\t\t\t$scope.errors = true;\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t$scope.chooseFile = function(){\n\t\t\t\t\tconsole.log(\"chooseFile\");\n\t\t\t\t\t$(fileInput).click();\n\t\t\t\t}\n\n\t\t\t\t$scope.clearFile = function(){\n\t\t\t\t\t$scope.videoad.video = {}\n\t\t\t\t}\n\n\t\t\t\tfunction abortUpload(){\n\t\t\t\t\tsetProgress(0);\n\t\t\t\t\t$scope.req && $scope.req.abort();\n\t\t\t\t\t$scope.videoad.video = {}\n\t\t\t\t\tsetProgress(0);\n\t\t\t\t}\n\n\t\t\t\tfunction abortEncode(){\n\t\t\t\t\t$.ajax(\"https://app.zencoder.com/api/v2/jobs/\" + $scope.videoad.video.job_id + \"/cancel.json?api_key=\" + $window.videoAttrs.zencoderApiKey, {\n\t\t\t\t\t\ttype: \"PUT\",\n\t\t\t\t\t\tsuccess: function(data) {\n\t\t\t\t\t\t\t$scope.videoad.video.status = 3;\n\t\t\t\t\t\t\tfakeInput.val(\"Encoding failed! Please try again.\");\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t$scope.abort = function(){\n\t\t\t\t\tif($scope.encoding){\n\t\t\t\t\t\tabortEncode();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}else{\n\t\t\t\t\t\tabortUpload();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction setProgress(progress){\n\t\t\t\t\tif (progress === 0 || progress === 100) {\n\t\t\t\t\t\tprogressEl.hide();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif($scope.lastProgress === 0 || Math.abs(progress - $scope.lastProgress) > 2) {\n\t\t\t\t\t\tprogressBar.css('width', Math.floor(progress) + '%');\n\t\t\t\t\t\t$scope.lastProgress = progress;\n\t\t\t\t\t\tprogressEl.show();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction setProgressText(text){\n\t\t\t\t\tprogressText.html(text);\n\t\t\t\t}\n\n\t\t\t\tfunction updateEncodeProgress(){\n\t\t\t\t\tprogressBar.addClass('progress-bar-success');\n\n\t\t\t\t\tdelete $http.defaults.headers.common['X-Requested-With'];\n\t\t\t\t\t$http({\n\t\t\t\t\t\turl: \"https://app.zencoder.com/api/v2/jobs/\" + $scope.videoad.video.job_id + \"/progress.json\",\n\t\t\t\t\t\tmethod: 'GET',\n\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\tapi_key: $window.videoAttrs.zencoderApiKey\n\t\t\t\t\t\t},\n\t\t\t\t\t\tuseXDomain: true\n\t\t\t\t\t}).success(function(data){\n\t\t\t\t\t\tif(data.state === \"waiting\" || data.state === \"pending\" || data.state === \"processing\") {\n\t\t\t\t\t\t\t$scope.videoad.video.status = 2;\n\t\t\t\t\t\t\tif(data.progress > 5) {\n\t\t\t\t\t\t\t\tsetProgress(data.progress);\n\t\t\t\t\t\t\t\t$timeout(updateEncodeProgress, 500);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t$timeout(updateEncodeProgress, 2000);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsetProgress(0);\n\t\t\t\t\t\t\tif(data.state == \"finished\") {\n\t\t\t\t\t\t\t\t$scope.videoad.video.status = 1;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif(data.state == \"failed\" || data.state == \"cancelled\") {\n\t\t\t\t\t\t\t\t$scope.videoad.video.status = 3;\n\t\t\t\t\t\t\t\tfakeInput.val(\"Encoding failed! Please try again.\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}).error(function(data){\n\t\t\t\t\t\t$scope.errors = true;\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tvar initialCheckRan = false;\n\t\t\t\t$scope.$watch('videoad.video', function(){\n\t\t\t\t\tif($scope.videoad.video && $scope.videoad.video.job_id && !initialCheckRan){\n\t\t\t\t\t\tupdateEncodeProgress();\n\t\t\t\t\t\tinitialCheckRan = true;\n\t\t\t\t\t}\n\t\t\t\t})\n\n\n\t\t\t}\n\t\t}\n\t});","'use strict';\n\nangular.module('video-ads')\n  .directive('deliveryChart', function() {\n    return {\n      restrict: 'E',\n      templateUrl: 'views/partials/chart.html',\n      scope: {\n        impressions: '@impressions'\n      },\n      //Setting up Highcharts options\n      controller: function($scope) {\n        $scope.semiCircleConfig = {\n          options: {\n            chart: {\n              type: 'pie',\n              backgroundColor: 'transparent',\n              height: 75,\n              margin: 0,\n              width: 75,\n            },\n            credits: { enabled: false },\n            tooltip: { enabled: false },\n            colors: ['#008d52', '#e2e2e2'],\n          },\n          series: [{\n            dataLabels: { enabled: false },\n            states: {\n              hover: {\n                 enabled: false\n              }\n            },\n            animation: false,\n            startAngle: -90,\n            endAngle: 90,\n            center: ['50%', '75%'],\n            innerSize: '50%',\n            name: 'Delivery',\n            data: [\n              parseInt($scope.impressions), \n              (100 - parseInt($scope.impressions))\n            ]\n          }],\n          title: {\n            text: ''\n          },\n          subtitle: {\n            text: ''\n          },\n          loading: false\n        };\n      }\n    }\n  });","\"use strict\";\n//Service to get / create / delete video ads.\nangular.module(\"video-ads\")\n\t.factory('videoAdService', \n        function (Restangular) {\n    \t\tRestangular.setBaseUrl(\"/api/v1/\");\n    \t\tRestangular.setRequestSuffix(\"/\");\n\n            return Restangular.service(\"videoads\");\n\t})\n    .config(function (RestangularProvider) {\n        // Restangular likes lists to be returned as lists. DRF returns lists as a JSON object, with the list of objects inside of the response.results object.\n        // So, we write this response interceptor in order to return data.results in teh case the current operation is getList\n        RestangularProvider.addResponseInterceptor(function(data, operation) {\n            if (operation === \"getList\") {\n                var results = data.results;\n                results.meta = {\n                    count: data.count,\n                    prev: data.prev,\n                    next: data.next\n                };\n\n                return results;\n            }\n            return data;\n        });\n    });","angular.module('video-ads')\n    .factory('authInterceptor', function($rootScope, $q, $window, $location, httpRequestBuffer) {\n        return {\n            'request': function(config) {\n                config.headers = config.headers || {};\n                if ($window.sessionStorage.token) {\n                    config.headers.Authorization = \"JWT \" + $window.sessionStorage.token;\n                }\n                return config;\n            },\n            'responseError': function(response) {\n                if (!response.config.ignoreAuthModule) {\n                    if (response.status == 403) {\n                        var deferred = $q.defer();\n                        httpRequestBuffer.append(response.config, deferred)\n                        $rootScope.$broadcast('auth-forbidden', response);\n                    }\n                }\n                return $q.reject(response);\n            }\n        }\n    })\n    .config(function($httpProvider) {\n        $httpProvider.interceptors.push('authInterceptor');\n    })\n    .service(\"authService\", function($window, $http, $rootScope, $location, httpRequestBuffer) {\n        _login = function(username, password) {\n            return $http.post(\"/api-token-auth\")\n                .then(function(response) {\n                    $window.sessionStorage.token = response.data.token;\n                });\n        }\n        _refreshToken = function() {\n            return $http.post(\"/api-token-refresh\", {\n                    \"token\": $window.sessionStorage.token\n                }, {\n                    \"ignoreAuthModule\": true\n                }).success(function(response) {\n                    $window.sessionStorage.token = response.token;\n                    httpRequestBuffer.retryAll()\n                })\n                .error(function() {\n                    httpRequestBuffer.rejectAll();\n                    $location.path(\"/login\");\n                });\n        }\n\n        $rootScope.$watch(\"auth-forbidden\", function() {\n            _refreshToken();\n        });\n        return {\n            login: _login,\n            refreshToken: _refreshToken\n        }\n    })\n// Thanks to witoldsz/angular-http-auth\n.factory('httpRequestBuffer', ['$injector',\n    function($injector) {\n        var buffer = [];\n\n        var $http;\n\n        function _retryHttpRequest(config, deferred) {\n            function successCallback(response) {\n                deferred.resolve(response);\n            }\n\n            function errorCallback(response) {\n                deferred.reject(response);\n            }\n            $http = $http || $injector.get(\"$http\");\n            $http(config).then(successCallback, errorCallback);\n        }\n\n        return {\n            append: function(config, deferred) {\n                buffer.push({\n                    config: config,\n                    deferred: deferred\n                });\n            },\n            rejectAll: function(reason) {\n                if (reason) {\n                    _.each(buffer, function(request) {\n                        request.deferred.reject(reason);\n                    });\n                }\n                buffer = [];\n            },\n            retryAll: function() {\n                _.each(buffer, function(request) {\n                    _retryHttpRequest(request.config, request.deferred);\n                });\n            }\n        }\n\n    }\n]);","'use strict';\n\nangular.module('video-ads')\n\t.filter('convertToLocal', function() {\n    return function (input) {\n      if (input) {\n        return moment.utc(input).local().format('YYYY-MM-DD hh:mm A');\n      }\n      return input;\n    };\n  });"]}